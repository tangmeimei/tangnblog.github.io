(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-079580e4"],{1:function(e,t){},2:function(e,t){},3:function(e,t){},4:function(e,t){},"4f32":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container"},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0}},[a("el-form-item",{attrs:{label:"角色名称",prop:"roleName"}},[a("el-input",{staticStyle:{width:"200px"},attrs:{clearable:"",placeholder:"请输入角色名称",oninput:"value=value.replace(/\\s+/g,'')",maxlength:"50"},model:{value:e.queryListPa.roleName,callback:function(t){e.$set(e.queryListPa,"roleName",t)},expression:"queryListPa.roleName"}})],1),a("el-form-item",{attrs:{label:"状态"}},[a("el-select",{staticStyle:{width:"200px"},attrs:{clearable:""},model:{value:e.queryListPa.roleStatus,callback:function(t){e.$set(e.queryListPa,"roleStatus",t)},expression:"queryListPa.roleStatus"}},e._l(e.orgStatusData,(function(e){return a("el-option",{key:e.value,attrs:{label:e.text,value:e.value}})})),1)],1),a("div",{staticClass:"right-btn"},[a("el-button",{directives:[{name:"has",rawName:"v-has",value:"database.role.add",expression:"'database.role.add'"}],staticClass:"but-91",attrs:{size:"mini"},on:{click:e.handleAdd}},[e._v("新 增")]),a("el-button",{staticClass:"but-91",attrs:{size:"mini"},on:{click:e.resetRoleList}},[e._v("重 置")]),a("el-button",{directives:[{name:"has",rawName:"v-has",value:"database.role.list",expression:"'database.role.list'"}],staticClass:"but-91",attrs:{size:"mini"},on:{click:e.queryRoleListByKeyword}},[e._v("查 询")])],1)],1),a("div",{staticClass:"table-min"},[a("el-table",{attrs:{height:"520px",data:e.roleTableList,"tooltip-effect":"dark","header-cell-style":{background:"#fff",textAlign:"center",color:"#333"}}},[a("el-table-column",{attrs:{width:"100",type:"index",align:"center",label:"序号",index:e.indexMethod,"show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{prop:"roleName",width:"300px",align:"left",label:"角色名称","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{prop:"displayOrder",label:"排序",align:"center","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{prop:"roleStatus",label:"状态",align:"center","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.getqueryLabelById(e.orgStatusData,t.row.roleStatus)))])]}}])}),a("el-table-column",{attrs:{prop:"roleStatus",label:"人员数量",align:"center","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{color:"#078bfd",cursor:"pointer"},on:{click:function(a){return e.showUserInfo(t.row)}}},[e._v(e._s(t.row.userSum))])]}}])}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,label:"更新时间",align:"center",prop:"mdeUpdatedDate"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("timeFormat")(t.row.mdeUpdatedDate)))])]}}])}),a("el-table-column",{attrs:{label:"操作",align:"center",width:"250","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{directives:[{name:"has",rawName:"v-has",value:"database.role.edit",expression:"'database.role.edit'"}],staticStyle:{color:"#078BFD","font-size":"14px"},attrs:{size:"mini",type:"text"},on:{click:function(a){return e.handleUpdate(t.row)}}},[e._v("编辑")]),a("el-button",{directives:[{name:"has",rawName:"v-has",value:"database.role.dataRange",expression:"'database.role.dataRange'"}],staticStyle:{color:"#078BFD","font-size":"14px"},attrs:{size:"mini",type:"text"},on:{click:function(a){return e.gotoAuthorization(t.row)}}},[e._v("数据权限")]),a("el-button",{directives:[{name:"has",rawName:"v-has",value:"database.role.delete",expression:"'database.role.delete'"}],staticStyle:{color:"#078BFD","font-size":"14px"},attrs:{size:"mini",type:"text"},on:{click:function(a){return e.handleDelete(t.row)}}},[e._v("删除")])]}}])})],1)],1),a("div",{staticClass:"block pagination"},[a("el-pagination",{attrs:{"page-sizes":[15,30,50],"page-size":e.pagePa.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.pagePa.rowCount},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:pageSize":function(t){return e.$set(e.pagePa,"pageSize",t)},"update:page-size":function(t){return e.$set(e.pagePa,"pageSize",t)}}}),a("el-dialog",{staticClass:"addModal",attrs:{title:e.formData.roleId?"编辑角色":"新增角色",visible:e.addOreditRoleModeStatus,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.addOreditRoleModeStatus=t},close:e.closeRest}},[a("el-form",{ref:"formData",attrs:{model:e.formData,rules:e.rules,"label-width":"80px"}},[a("el-row",[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"角色名称",prop:"roleName"}},[a("el-input",{staticStyle:{width:"200px",float:"left"},attrs:{placeholder:"请输入角色名称",clearable:"",maxlength:"50"},model:{value:e.formData.roleName,callback:function(t){e.$set(e.formData,"roleName",t)},expression:"formData.roleName"}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"排列顺序",prop:"displayOrder"}},[a("el-input-number",{staticStyle:{width:"200px",float:"left"},attrs:{"controls-position":"right",min:1,max:1e10,oninput:"value=value.replace(/\\D|^0/g,'')"},model:{value:e.formData.displayOrder,callback:function(t){e.$set(e.formData,"displayOrder",t)},expression:"formData.displayOrder"}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"状态",prop:"roleStatus"}},[a("el-radio-group",{staticClass:"inpWidth",staticStyle:{float:"left","line-height":"40px"},model:{value:e.formData.roleStatus,callback:function(t){e.$set(e.formData,"roleStatus",t)},expression:"formData.roleStatus"}},e._l(e.orgStatusData,(function(t,o){return a("el-radio",{key:o,attrs:{label:t.value}},[e._v(e._s(t.text))])})),1)],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"菜单权限",prop:""}},[a("el-tree",{ref:"treeTwo",attrs:{data:e.menuTreeList,"default-checked-keys":e.showMenuIdList,"show-checkbox":"","node-key":"resourceId",props:e.menumenuDefaultProps},on:{"check-change":e.checkMenuSelect}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"备注",prop:"roleRemark"}},[a("div",{staticClass:"inpTextarea"},[a("el-input",{attrs:{type:"textarea",maxlength:"300",resize:"none","show-word-limit":""},model:{value:e.formData.roleRemark,callback:function(t){e.$set(e.formData,"roleRemark",t)},expression:"formData.roleRemark"}})],1)])],1)],1)],1),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"but-90",on:{click:e.cancel}},[e._v("取 消")]),a("el-button",{staticClass:"but-90",attrs:{type:"primary"},on:{click:e.submitFormAndCheck}},[e._v("确 定")])],1)],1),a("el-dialog",{attrs:{title:"分配数据权限",visible:e.authorizationModeShow,width:"550px","close-on-click-modal":!1},on:{"update:visible":function(t){e.authorizationModeShow=t}}},[a("el-form",{ref:"formAuthorizationData",attrs:{model:e.formAuthorizationData,rules:e.authorizationRules,"label-width":"98px"}},[a("el-row",[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"角色名称",prop:"roleName"}},[a("el-input",{attrs:{disabled:!0,placeholder:"请输入角色名称"},model:{value:e.formAuthorizationData.roleName,callback:function(t){e.$set(e.formAuthorizationData,"roleName",t)},expression:"formAuthorizationData.roleName"}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"权限范围",prop:"scope"}},[a("el-select",{staticStyle:{width:"100%"},model:{value:e.formAuthorizationData.scope,callback:function(t){e.$set(e.formAuthorizationData,"scope",t)},expression:"formAuthorizationData.scope"}},e._l(e.scopeData,(function(e){return a("el-option",{key:e.value,attrs:{label:e.text,value:e.value}})})),1)],1)],1),e.formAuthorizationData.scope&&"2"==e.formAuthorizationData.scope?a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"自定数据权限",prop:"scope"}},[a("el-tree",{ref:"tree",attrs:{data:e.organTreeList,"default-checked-keys":e.showOrganIdList,"show-checkbox":"","node-key":"orgId",props:e.organDefaultProps},on:{"check-change":e.checkOrganSelect}})],1)],1):e._e()],1)],1),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"but-90",on:{click:function(t){e.authorizationModeShow=!1}}},[e._v("取 消")]),a("el-button",{staticClass:"but-90",attrs:{type:"primary"},on:{click:e.submitAuthorizationForm}},[e._v("确 定")])],1)],1)],1),a("el-dialog",{staticClass:"userInfoModal",attrs:{title:"用户信息",visible:e.isShowUserModal,width:"40%",height:"80%"},on:{"update:visible":function(t){e.isShowUserModal=t}}},[a("tb-table",{staticStyle:{width:"100%"},attrs:{border:"","header-cell-style":{"text-align":"center"},tableData:e.userTableData,columns:e.columns,isShowPagenation:!1}})],1)],1)},r=[],l=a("2909"),s=a("5530"),n=a("1da1"),i=(a("96cf"),a("4de4"),a("b0c0"),a("d81d"),a("a15b"),a("a434"),a("bf19"),a("ac1f"),a("5319"),a("159b"),a("a417")),u=a("ca17"),c=a.n(u),d=(a("542c"),a("ed08")),f=(a("ba0f"),function(e){return[{label:"序号",type:"index",width:"50px"},{label:"工号",prop:"loginName",align:"left"},{label:"姓名",prop:"username",align:"left"},{label:"用户角色",prop:"userRoles",align:"left"},{label:"手机号码",prop:"userPhone",align:"left"},{label:"公司邮箱",prop:"companyEmail",align:"left"},{label:"用户状态",prop:"userStatusCn",kind:"render",render:function(e,t){var a="停用"===t.row.userStatusCn?"red":"";return e("span",{style:{color:a}},t.row.userStatusCn)}},{label:"操作",prop:"",kind:"render",render:function(t,a){return t("span",{style:{color:"#078bfd",cursor:"pointer"},on:{click:function(){e.removeUser(a)}}},"移除用户")}}]}),h=a("8cc7"),p={components:{Treeselect:c.a,tbTable:h["a"]},data:function(){return{userTableData:[],isShowUserModal:!1,showOrganIdList:[],showMenuIdList:[],organTreeList:[],menumenuDefaultProps:{children:"children",label:"name",id:"resourceId"},organDefaultProps:{children:"children",label:"orgName",id:"orgId"},authorizationModeShow:!1,formAuthorizationData:{},authorizationRules:{},rules:{roleName:[{required:!0,message:"请输入角色名称",trigger:"change"}],displayOrder:[{required:!0,message:"请输入顺序",trigger:"change"}],roleStatus:[{required:!1,message:"请选择状态",trigger:"change"}],roleRemark:[{required:!1,message:"请输入备注",trigger:"blur"}]},addOreditRoleModeStatus:!1,formData:{roleStatus:"IT_ROST_001"},roleTableList:[],queryListPa:{},pagePa:{pageIndex:1,pageSize:15,rowCount:0},selectOrganIdList:[],selectMenuIdList:[],menuTreeList:[]}},computed:{columns:function(){return f(this)},scopeData:function(){return this.$store.state.baseData.baseDataOptionList.IT_RSCP},orgStatusData:function(){return this.$store.state.baseData.baseDataOptionList.IT_ROST}},mounted:function(){var e=this;Object(i["x"])({}).then((function(t){var a=t.filter((function(e){return e.authResource.name&&e.authResource.resourceId}));e.menuTreeList=e.handleTreeData(a)})),Object(i["z"])({}).then((function(t){t&&t.length>0?e.organTreeList=t:e.organTreeList=[]})),this.queryRoleData()},methods:{showUserInfo:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function a(){var o,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.isShowUserModal=!0,o=e.roleId,a.next=4,Object(i["J"])({roleId:o});case 4:r=a.sent,t.userTableData=r.map((function(e){if(!e.userInfo||!e.roleInfos)return{};var t=e.roleInfos.map((function(e){return e.roleName}));return Object(s["a"])(Object(s["a"])({},e),{},{username:e.userInfo.userName,loginName:e.userInfo.loginName,userRoles:t.join(","),userStatusCn:e.userStatusCn,removeId:o,userPhone:e.userInfo.userPhone,companyEmail:e.userInfo.userEmail})})),console.log(r,"角色list");case 7:case"end":return a.stop()}}),a)})))()},removeUser:function(e){for(var t=this,a=e.row,o=0;o<a.roleIds.length;o++)if(a.roleIds[o]===a.removeId){a.roleIds.splice(o,1);break}this.$confirm("您是否要移除该用户?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(n["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(i["R"])(a);case 2:e.sent,t.showUserInfo({roleId:a.removeId}),t.queryRoleData(),t.judgeUser(a);case 6:case"end":return e.stop()}}),e)}))))},judgeUser:function(e){var t=this;if(console.log("当前操作的用户：",e),console.log("当前登录的用户：",this.$store.state.user.userInfo),this.$store.state.user.userInfo.userId===e.userInfo.userId){console.log("操作的是当前用户");var a=Object(l["a"])(this.$store.state.app.roleData.rolesList),o=Object(l["a"])(e.roleIds),r=a.length,s=o.length;console.log("处理之前的两个数组：",a,o);for(var n=r-1;n>-1;--n)for(var i=s-1;i>-1;--i)if(a[n].roleInfo.roleId===o[i]){a.splice(n,1),o.splice(i,1);break}if(console.log("处理之后的两个数组：",a,o),a.length){var u=a.some((function(e){return e.roleInfo.roleId===t.$store.state.app.roleData.defaultRole&&(console.log("当前删除的角色是使用的角色"),!0)}));u?(window.location.hash="/dashboard",window.location.reload()):this.$store.dispatch("app/GET_ROLE")}else o.length&&(console.log("新增角色"),this.$store.dispatch("app/GET_ROLE"))}else console.log("操作的并不是当前用户")},handleTime:function(e){if(e){var t=new Date(e).toJSON();return new Date(new Date(t)+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"")}return"--"},indexMethod:function(e){return this.pagePa.pageSize*this.pagePa.pageIndex+e-this.pagePa.pageSize+1},handleTreeData:function(e){if(e&&e.length>0){for(var t=0;t<e.length;t++)e[t].authResource&&e[t].authResource.name&&e[t].authResource.resourceId&&(e[t].name=e[t].authResource.name,e[t].resourceId=e[t].authResource.resourceId,e[t].children=e[t].menuResourceVoList,this.handleTreeData(e[t].children));return e}return[]},getqueryLabelById:function(e,t){return Object(d["k"])(e,t)},checkOrganSelect:function(e,t,a){var o=this.$refs.tree.getCheckedKeys();this.selectOrganIdList=o},checkMenuSelect:function(e,t,a){var o=this.$refs.treeTwo.getCheckedKeys(),r=this.$refs.treeTwo.getHalfCheckedKeys();r.forEach((function(e,t){o.push(e)})),this.selectMenuIdList=o},handleSizeChange:function(e){this.pagePa.pageSize=e,this.queryRoleData()},handleCurrentChange:function(e){this.pagePa.pageIndex=e,this.queryRoleData()},queryRoleData:function(){var e=this,t={input:this.queryListPa,nextToken:"",pageEnd:0,pageIndex:this.pagePa.pageIndex,pageSize:this.pagePa.pageSize,pageStart:0};Object(i["G"])(t).then((function(t){t.result&&t.result.length>0?(console.log("res.result",t.result),e.roleTableList=t.result.map((function(e){return Object(s["a"])(Object(s["a"])({},e),e.roleInfo)})),e.pagePa.rowCount=t.rowCount):(e.roleTableList=[],e.pagePa.rowCount=0)}))},cancel:function(){this.addOreditRoleModeStatus=!1,this.resetForm()},addSaveReole:function(e){var t=this,a={org:[],queryType:e.roleId?"resourceId":null,relations:[],roleInfo:{displayOrder:e.displayOrder||null,roleId:e.roleId||null,roleName:e.roleName||null,roleRemark:e.roleRemark||null,roleStatus:e.roleStatus||null}};this.selectMenuIdList.forEach((function(t,o){t&&a.relations.push({roleId:e.roleId||null,resourceId:t})})),Object(i["X"])(a).then((function(a){t.$message({message:"".concat(e.roleId?"编辑成功":"新增成功"),type:"success"}),t.addOreditRoleModeStatus=!1,t.queryRoleData()}))},submitFormAndCheck:function(){var e=this;this.formData.roleName&&!this.formData.roleId?Object(i["d"])({roleName:this.formData.roleName}).then((function(t){e.validAddRoleForm()}),(function(t){e.formData.roleName="",e.validAddRoleForm()})):this.validAddRoleForm()},validAddRoleForm:function(){var e=this;this.$refs["formData"].validate((function(t){t?e.addSaveReole(e.formData):e.$message({type:"error",message:"请把信息填写完整!"})}))},handleAdd:function(e){this.addOreditRoleModeStatus=!0,this.resetForm(),void 0!=this.$refs["formData"]&&this.$refs["formData"].resetFields()},closeRest:function(){void 0!=this.$refs["formData"]&&this.$refs["formData"].resetFields()},resetForm:function(){var e=this;this.selectOrganIdList=[],this.selectMenuIdList=[],this.showOrganIdList=[],this.showMenuIdList=[],this.formData={roleName:void 0,displayOrder:void 0,roleStatus:"IT_ROST_001",roleRemark:void 0},this.$nextTick((function(){void 0!==e.$refs.treeTwo&&e.$refs.treeTwo.setCheckedKeys([])})),this.$nextTick((function(){void 0!==e.$refs.treeTwo&&e.$refs.treeTwo.setCheckedKeys([])}))},gotoAuthorization:function(e){var t=this;this.authorizationModeShow=!0,this.resetForm(),this.formAuthorizationData={roleName:void 0,scope:void 0},Object(i["E"])({roleId:e.roleId}).then((function(e){t.formAuthorizationData.roleName=e.roleInfo.roleName,t.formAuthorizationData.scope=e.roleInfo.scope||"",t.formData=e;var a=[];e.org&&e.org.length>0&&e.org.forEach((function(e){a.push(e.orgId)})),t.showOrganIdList=a,t.selectOrganIdList=a}))},submitAuthorizationForm:function(){var e=this;this.$refs["formAuthorizationData"].validate((function(t){if(t){var a={org:[],queryType:"orgId",relations:[],roleInfo:{displayOrder:e.formData.roleInfo.displayOrder||null,roleId:e.formData.roleInfo.roleId||null,roleName:e.formData.roleInfo.roleName||null,roleRemark:e.formData.roleInfo.roleRemark||null,roleStatus:e.formData.roleInfo.roleStatus||null,scope:e.formAuthorizationData.scope||null}};"IT_RSCP_002"==e.formAuthorizationData.scope&&e.selectOrganIdList.length>0?e.selectOrganIdList.forEach((function(e,t){e&&a.org.push({orgId:e||null,relationType:"have"})})):a.org=[],Object(i["X"])(a).then((function(t){e.$message({message:"保存成功",type:"success"}),e.authorizationModeShow=!1,e.queryRoleData()}))}}))},handleUpdate:function(e){var t=this;this.addOreditRoleModeStatus=!0,this.resetForm();var a=[];Object(i["E"])({roleId:e.roleId}).then((function(e){t.formData.displayOrder=e.roleInfo.displayOrder,t.formData.roleName=e.roleInfo.roleName,t.formData.roleRemark=e.roleInfo.roleRemark,t.formData.roleStatus=e.roleInfo.roleStatus,t.formData.roleId=e.roleInfo.roleId,t.showMenuIdList=e.viewResourceIds,t.selectMenuIdList=a}))},handleDelete:function(e){var t=this;t.$confirm("确认删除?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(i["g"])({roleId:e.roleId}).then((function(e){t.$message({type:"success",message:"删除成功!"}),t.queryRoleData()}),(function(e){}))}))},judgeDelRole:function(e){e===this.$store.state.app.roleData.defaultRole&&(console.log("当前删除的角色是使用的角色"),window.location.hash="/dashboard",window.location.reload());var t=this.$store.state.app.roleData.rolesList.some((function(t){return t.roleInfo.roleId===e}));t&&(console.log("当前用户拥有被删除的角色"),this.$store.dispatch("app/GET_ROLE"))},queryRoleListByKeyword:function(){this.queryRoleData()},resetRoleList:function(){this.queryListPa={},this.queryRoleData()},handleHeaderCellClass:function(e){e.row;var t=e.column;e.rowIndex,e.columnIndex;this.sortData.forEach((function(e){if(t.property===e.field){var a="";"desc"===e.display&&(a="descending"),"asc"===e.display&&(a="ascending"),t.order=a}}))}}},m=p,g=(a("ddb3"),a("2877")),b=Object(g["a"])(m,o,r,!1,null,"af21ab62",null);t["default"]=b.exports},5:function(e,t){},"6ba5":function(e,t,a){},bf19:function(e,t,a){"use strict";var o=a("23e7");o({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return URL.prototype.toString.call(this)}})},ddb3:function(e,t,a){"use strict";a("6ba5")}}]);