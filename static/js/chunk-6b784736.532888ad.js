(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6b784736"],{"208e":function(t,e,a){"use strict";a("4473")},"3f5e":function(t,e,a){"use strict";a("b775")},4473:function(t,e,a){},aab4:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"customer-container"},[a("div",{staticClass:"search-wrap"},[a("zm-Search",{attrs:{inputList:t.inputList,btnConfig:t.btnConfig},on:{search:t.search,addCustomer:t.addCustomer,reset:t.reset}})],1),a("div",{staticClass:"tableContent"},[a("zm-table",{ref:"tableRef",staticStyle:{width:"100%"},attrs:{tableData:t.tableData,columns:t.columns,currentPage:t.pageData.pageIndex,pageSize:t.pageData.pageSize,total:t.pageData.pageCount,sizeList:t.sizeList,height:"550px"},on:{sortChange:t.sortChange,viewFn:t.viewFn,editFn:t.editFn,quotePrice:t.quotePrice,deleteFn:t.deleteFn,handleCurrentChange:t.handleCurrentChange,handleSizeChange:t.handleSizeChange,changeVirtualContract:t.changeVirtualContract,exportQuotePrice:t.exportQuotePrice}})],1),a("zm-modal",{staticClass:"quoteModal",attrs:{title:t.contractTitle+"-报价设置",openModal:t.isOpenModal},on:{"update:openModal":function(e){t.isOpenModal=e},"update:open-modal":function(e){t.isOpenModal=e}}},[a("quote-price",{key:t.key,attrs:{slot:"content",curContractId:t.curContractId,contractType:t.contractTitle,isQuote:t.isQuote,contractMoney:t.contractMoney},on:{closeQuotePricePage:t.closeQuotePricePage},slot:"content"})],1),a("zm-modal",{staticClass:"quoteModal",attrs:{title:"查看合同附件",width:"60%",openModal:t.contractFileModal},on:{"update:openModal":function(e){t.contractFileModal=e},"update:open-modal":function(e){t.contractFileModal=e}}},[a("div",{staticClass:"contractFile",attrs:{slot:"content"},slot:"content"},[t._v(" 合同附件 "),a("zm-table",{staticStyle:{width:"100%","margin-top":"30px"},attrs:{tableData:t.contractTableData,columns:t.contractColumns,border:"",isShowPagenation:!1}})],1)])],1)},r=[],o=a("1da1"),c=a("5530"),i=(a("96cf"),a("d81d"),a("159b"),a("a434"),a("8cc7")),s=a("a937"),l=a("bf3e"),d=a("069c"),p=(a("fb6a"),a("b64b"),a("a9e3"),a("ed08")),u=a("5f98"),h=a("4360"),f=h["a"].state.baseData.baseDataOptionList.IT_CTCT,b=h["a"].state.baseData.baseDataOptionList.IT_CTST,m=h["a"].state.baseData.baseDataOptionList.IT_FILE,C=h["a"].state.baseData.baseDataOptionList.IT_CTFT,g=function(t){return[{type:"text-input",bind_key:"keyword",label:"合同查询",labelWidth:"90",placeholder:"合同名称/编号/客户名称",span:6},{type:"select-input",bind_key:"contractContentType",label:"合同类型",optionList:f,span:6},{type:"select-input",bind_key:"contractStatus",label:"执行状态",span:6,optionList:b},{type:"select-input",bind_key:"isArchive",label:"规档状态",span:6,optionList:m},{type:"date-input",span:7,labelWidth:90,label:"合同起始日期",bind_key:"startDate",datePickerType:"daterange",inputWidth:"80px"}]},w={span:24,customList:[{role:"contract.formal.add",customBtnText:"新增",changeFn:"addCustomer"}]},D=function(t){return[{label:"序号",kind:"render",fixed:"left",width:"50px",render:function(e,a){return e("span",t.indexMethod(a.$index))}},{label:"客户简称",prop:"clientSimpleName",align:"left",sortable:!0,minWidth:"120px"},{label:"合同类型",prop:"contractType",minWidth:"120px",align:"left",kind:"render",render:function(t,e){var a=Object(p["k"])(f,e.row.contractContentType);return t("span",{},a)}},{label:"合同名称",kind:"render",prop:"contractName",align:"left",minWidth:"180px",render:function(e,a){return e("span",{style:{color:"#078BFD",cursor:"pointer",fontSize:"14px"},class:{clickHover:!0},on:{click:function(){var e=Object(u["a"])("contract.formal.info");e&&(t.$router.push({path:"/contract/detailContract",query:{id:a.row.contractId}}),t.CHANGE_FC_DETAIL_STATUS(!0))}}},a.row.contractName)}},{label:"合同开始日期",prop:"startDate",kind:"render",render:function(t,e){var a=e.row.startDate||"",n=a.slice(0,a.indexOf("T"));return t("span",n)},minWidth:"140px",sortable:!0},{label:"合同结束日期",prop:"endDate",sortable:!0,kind:"render",render:function(t,e){var a=e.row.endDate||"",n=a.slice(0,a.indexOf("T"));return t("span",n)},minWidth:"140px"},{label:"合同附件",prop:"fileCount",kind:"render",render:function(e,a){var n=a.row.fileCount+"份";return e("span",{class:{clickHover:!0},style:{color:"#078BFD",cursor:"pointer",fontSize:"14px"},on:{click:function(){var e=Object(u["a"])("contract.formal.info");e&&t.openFileModal(a.row.contractId)}}},n)}},{label:"执行状态",prop:"contractStatus",minWidth:"100px",kind:"render",render:function(t,e){var a=Object(p["k"])(b,e.row.contractStatus);return t("span",a)}},{label:"归档状态",prop:"isArchive",sortable:!0,minWidth:"120px",kind:"render",render:function(t,e){return t("span","IT_FILE_001"===e.row.isArchive?"未归档":"已归档")}},{label:"正式合同档案编号",prop:"contractId",minWidth:"200px"},{label:"虚拟合同编号",prop:"otherContractId",minWidth:"180px",kind:"render",render:function(e,a){return e("span",{style:{color:"#078BFD",cursor:"pointer",fontSize:"14px"},class:{clickHover:!0},on:{click:function(){var e=Object(u["a"])("contract.formal.info");e&&t.$router.push({path:"/contract/detailVCtrct",query:{id:a.row.otherContractId}})}}},a.row.otherContractId)}},{label:"操作",fixed:"right",width:"120px",kind:"formatBtn",moreBtnRoles:"contract.formal.edit,contract.formal.delete,contract.formal.price,contract.formal.price.export,contract.formal.transfervirtual",firstBtn:{text:"详情",role:"contract.formal.info",fn:"viewFn"},btnList:[{text:"编辑",fn:"editFn",role:"contract.formal.edit",isDisabled:function(t){return!!(t.contractPriceScope&&Object.keys(t.contractPriceScope).length>0)}},{text:"报价",fn:"quotePrice",role:"contract.formal.price",textFn:function(t){return Number(t.priceCount)>0?"已报价":"报价"},isDisabled:function(t){return!!(t.contractPriceScope&&Object.keys(t.contractPriceScope).length>0)}},{text:"导出报价",fn:"exportQuotePrice",role:"contract.formal.price.export",isDisabled:function(t){return!!(t.contractPriceScope&&Object.keys(t.contractPriceScope).length>0)}},{text:"转为虚拟合同",fn:"changeVirtualContract",role:"contract.formal.transfervirtual",isDisabled:function(t){return!!(t.contractPriceScope&&Object.keys(t.contractPriceScope).length>0)}},{text:"删除",fn:"deleteFn",role:"contract.formal.delete",isDisabled:function(t){return!!(t.contractPriceScope&&Object.keys(t.contractPriceScope).length>0)}}]}]},x=function(t){return[{label:"合同附件类型",prop:"contractFileType",kind:"render",render:function(t,e){var a=Object(p["k"])(C,e.row.contractFileType);return t("span",a)}},{label:"适用公司",prop:"relationNames"},{label:"文件名",prop:"fileName"},{label:"大小",prop:"fileSize",width:"120px",kind:"render",render:function(t,e){return t("div",e.row.fileSize+"kb")}},{label:"上传时间",prop:"uploadTime",kind:"render",render:function(t,e){var a=e.row.uploadTime||"",n=a.slice(0,a.indexOf("T"));return t("span",n)}},{label:"上传人",prop:"createorName",width:"120px"},{label:"操作",kind:"render",render:function(e,a){return e("div",[e("span",{class:{clickHover:!0},style:{color:"rgb(13, 166, 246)",cursor:"pointer",marginRight:"10px"},on:{click:function(){t.viewContract(a)}}},"预览"),e("span",{class:{clickHover:!0},style:{color:"rgb(13, 166, 246)",cursor:"pointer"},on:{click:function(){t.downloadContract(a)}}},"下载")])}}]},v=a("35ad"),k=(a("3f5e"),a("2f62")),T={name:"FormalContract",components:{zmTable:i["a"],zmSearch:s["a"],zmModal:l["a"],quotePrice:d["a"]},data:function(){var t=g(this),e=D(this),a=x(this);return{inputList:t,btnConfig:w,tableData:[],columns:e,pageData:{pageIndex:1,pageSize:15,pageCount:0},sizeList:[15,30,50],sortData:[],isOpenModal:!1,curContractId:"",contractTitle:"",contractFileModal:!1,contractTableData:[],contractColumns:a,isQuote:"",contractMoney:"",key:0,searchCacheData:{}}},computed:Object(c["a"])({},Object(k["e"])("listCacheFlag",["isReloadFC"])),beforeRouteEnter:function(t,e,a){a((function(t){t.isReloadFC&&(t.pageData.pageIndex=1,t.getContractList(),t.CHANGE_FC_STATUS(!1))}))},activated:function(){var t=this;this.$nextTick((function(){t.$refs.tableRef.doLayoutTable()}))},mounted:function(){this.getContractList()},methods:Object(c["a"])(Object(c["a"])({},Object(k["d"])("listCacheFlag",["CHANGE_FC_STATUS","CHANGE_FC_DETAIL_STATUS"])),{},{indexMethod:function(t){return this.pageData.pageSize*this.pageData.pageIndex+t-this.pageData.pageSize+1},getContractList:function(t){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var n,r,o,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=t||{},n.startDate&&(n.contractOverDate=n.startDate[1],n.startDate=n.startDate[0]),n.contractType="IT_CTTP_001",r={input:n},o=Object.assign({},e.pageData,r),o.input.displays=e.sortData,a.next=8,Object(v["f"])(o);case 8:i=a.sent,e.pageData.pageCount=i.rowCount,e.tableData=i.result&&i.result.map((function(t){return Object(c["a"])(Object(c["a"])({},t.contract),t)}));case 11:case"end":return a.stop()}}),a)})))()},addCustomer:function(t){this.$router.push("/contract/addContract")},search:function(t){this.pageData.pageIndex=1,this.searchCacheData=t,this.getContractList(t)},reset:function(){this.pageData.pageIndex=1,this.searchCacheData={},this.getContractList()},handleSizeChange:function(t){this.pageData.pageIndex=1,this.pageData.pageSize=t,this.getContractList(this.searchCacheData)},editFn:function(t){this.$router.push({path:"/contract/editContract",query:{id:t.contractId}})},viewFn:function(t){this.CHANGE_FC_DETAIL_STATUS(!0),this.$router.push({path:"/contract/detailContract",query:{id:t.contractId}})},deleteFn:function(t){var e=this;this.$confirm("此操作将永久删除该数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(o["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,Object(v["b"])({contractId:t.contractId});case 2:a.sent,e.$message.success("删除成功"),e.getContractList();case 5:case"end":return a.stop()}}),a)}))))},quotePrice:function(t){var e=this.$store.state.baseData.baseDataOptionList.IT_CTCT;this.contractMoney=t.contract.contractPrice||"",this.isQuote=t.priceCount,this.contractTitle=Object(p["k"])(e,t.contractContentType),this.isOpenModal=!0,this.curContractId=t.contractId,this.key++},openFileModal:function(t){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e.contractFileModal=!0,a.next=3,Object(v["e"])({contractId:t});case 3:n=a.sent,e.contractTableData=n[0]&&n.map((function(t){return Object(c["a"])(Object(c["a"])({},t.contractFile),{},{item:t})}));case 5:case"end":return a.stop()}}),a)})))()},handleCurrentChange:function(t){this.pageData.pageIndex=t,this.getContractList(this.searchCacheData)},closeQuotePricePage:function(){this.getContractList(),this.isOpenModal=!1},sortChange:function(t){var e=this,a="";a="ascending"===t.order?"asc":"desc";var n={display:a,field:t.prop};0===this.sortData.length?this.sortData.push(n):this.sortData.forEach((function(t,a){if(t.field===n.field){if(t.display===n.display)return void e.sortData.splice(a,1);e.sortData.splice(a,1),e.sortData.push(n)}else e.sortData.push(n)})),this.getContractList(this.searchCacheData)},viewContract:function(t){var e=t.row.fileId,a="https://www.tobowork.com//api/tobosoft-toms/cos/file/view/"+e;window.open(a)},downloadContract:function(t){var e=t.row.fileId,a="https://www.tobowork.com//api/tobosoft-toms/cos/file/download/"+e,n=document.createElement("a");n.setAttribute("download",t.row.fileName),n.href=a,document.body.appendChild(n),n.click(),n.remove()},changeVirtualContract:function(t){var e=t.contractId;this.$router.push({path:"/contract/addVCtrct",query:{formalContractId:e}})},exportQuotePrice:function(t){var e=t.contractId,a="https://www.tobowork.com//api/tobosoft-toms/excel/download/contractPrice/"+e,n=document.createElement("a");n.setAttribute("download","2222"),n.href=a,document.body.appendChild(n),n.click(),n.remove()}})},y=T,O=(a("208e"),a("2877")),S=Object(O["a"])(y,n,r,!1,null,"0eb89623",null);e["default"]=S.exports}}]);