(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6d0f30d2"],{"289c":function(e,t,n){},"62f4":function(e,t,n){},"85a4":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"toms-container"},[n("el-row",{staticStyle:{height:"100%"},attrs:{gutter:10}},[n("el-col",{staticClass:"col-padding",attrs:{span:4}},[n("div",{staticClass:"left-form"},[n("div",{staticClass:"title"},[n("span",[e._v("流程列表")])]),n("el-tree",{ref:"leftTree",staticStyle:{height:"calc(100%-38px)"},attrs:{data:e.processList,"default-expand-all":"","highlight-current":"","check-on-click-node":"",indent:35,"expand-on-click-node":!1,props:e.defaultProps},on:{"node-click":e.handleNameClick}})],1)]),n("el-col",{staticClass:"col-padding",attrs:{span:4}},[n("div",{staticClass:"center-form"},[n("div",{staticClass:"title"},[n("span",[e._v("表单列表")])]),n("el-tree",{ref:"centerTree",staticStyle:{height:"calc(100%-38px)"},attrs:{data:e.processNodeList,"default-expand-all":"","highlight-current":"",indent:10,"expand-on-click-node":!1,props:{children:"children",label:"nodeName",id:"nodeId"}},on:{"node-click":e.handleNodeClick}})],1)]),n("el-col",{staticClass:"col-padding",attrs:{span:16}},[n("div",{staticClass:"right-form"},[n("div",{staticClass:"top-content"},[n("div",{staticClass:"title"},[n("span",[e._v("表单权限")])]),n("el-row",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[n("el-col",{staticClass:"col-border",attrs:{span:24}},[n("div",{staticClass:"form-border"},[n("div",[e._v("操作权限")]),n("div",{staticStyle:{"margin-top":"10px"}},[n("el-row",[e.checkboxFlag?n("el-checkbox-group",{model:{value:e.operationList,callback:function(t){e.operationList=t},expression:"operationList"}},e._l(e.operationPermissionsList,(function(t,r){return n("el-col",{key:r,attrs:{span:4}},[n("el-checkbox",{attrs:{label:t.resourceCode}},[e._v(e._s(t.name))])],1)})),1):e._e()],1)],1)])]),n("el-col",{staticClass:"col-border",attrs:{span:24}},[n("div",[e._v("附件权限")]),n("div",{staticStyle:{"margin-top":"10px"}},[n("el-row",[e.checkboxFlag?n("el-checkbox-group",{model:{value:e.attachmentList,callback:function(t){e.attachmentList=t},expression:"attachmentList"}},e._l(e.attachmentPermissionsList,(function(t,r){return n("el-col",{key:r,attrs:{span:4}},[n("el-checkbox",{attrs:{label:t.resourceCode}},[e._v(e._s(t.name))])],1)})),1):e._e()],1)],1)]),n("el-col",{staticClass:"col-border",attrs:{span:12}},[n("div",[e._v("审批意见框")]),n("div",{staticStyle:{"margin-top":"10px"}},[n("el-row",[e.checkboxFlag?n("el-checkbox-group",{model:{value:e.opinionsValList,callback:function(t){e.opinionsValList=t},expression:"opinionsValList"}},e._l(e.isOpinionList,(function(t,r){return n("el-col",{key:r,attrs:{span:8}},[n("el-checkbox",{attrs:{label:t.resourceCode}},[e._v(e._s(t.name))])],1)})),1):e._e()],1)],1)]),n("el-col",{staticClass:"col-border",attrs:{span:12}},[n("div",[e._v("审批意见")]),n("div",{staticStyle:{"margin-top":"10px"}},[n("el-row",[e.checkboxFlag?n("el-checkbox-group",{model:{value:e.opinions,callback:function(t){e.opinions=t},expression:"opinions"}},e._l(e.opinionsList,(function(t,r){return n("el-col",{key:r,attrs:{span:8}},[n("el-checkbox",{attrs:{label:t.resourceCode}},[e._v(e._s(t.name))])],1)})),1):e._e()],1)],1)])],1)],1),n("el-row",{staticClass:"bottom-content"},[n("el-col",{staticClass:"formPane",attrs:{span:6}},[n("div",[n("div",{staticClass:"title"},[e._v("表单控件")]),n("el-tree",{ref:"rightTree",staticClass:"formPaneContent",attrs:{data:e.formList,"default-expand-all":"","highlight-current":"",indent:19,"expand-on-click-node":!1,props:{children:"children",label:"name",value:"formId"}},on:{"node-click":e.handleFormItemClick}})],1)]),n("el-col",{staticClass:"formPane",attrs:{span:18}},[n("processTreeTable",{directives:[{name:"loading",rawName:"v-loading",value:e.formLoading,expression:"formLoading"}],ref:"treeTable",attrs:{formCtrData:e.formCtrData}})],1)],1)],1)])],1),n("div",{staticClass:"toms-add-submitForm"},[n("div",{staticClass:"item",on:{click:e.closePage}},[e._v("关闭")]),n("Debounce",{attrs:{time:500,events:"click"}},[n("div",{directives:[{name:"has",rawName:"v-has",value:"flow.auth.submit",expression:"'flow.auth.submit'"}],staticClass:"item submit",on:{click:e.submitProcessConfig}},[e._v(" 提交 ")])])],1)],1)},a=[],o=n("1da1"),s=(n("96cf"),n("d81d"),n("99af"),n("159b"),n("4de4"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-tree",{ref:"leftTreeForm",attrs:{data:e.processList,"show-checkbox":"","node-key":"id","default-expand-all":"","highlight-current":"","check-on-click-node":"",indent:35,"expand-on-click-node":!1,props:e.defaultProps},on:{"check-change":e.handleNodeClick}})],1)}),i=[],c={name:"ProcessTree",props:{data:{type:Array,default:function(){return[]}},defaultProps:{type:Object,default:function(){return{id:"id",children:"children",label:"label"}}}},data:function(){return{leftCheckedId:"",formList:[]}},methods:{handleNodeClick:function(e,t,n){console.log(e),!0===t?(this.leftCheckedId=e.id,this.$refs.leftTreeForm.setCheckedKeys([e.id]),this.formList=[e]):this.leftCheckedId==e.id&&this.$refs.leftTreeForm.setCheckedKeys([e.id])}}},l=c,u=n("2877"),d=Object(u["a"])(l,s,i,!1,null,"083dac32",null),f=d.exports,h=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-form",{ref:"form",staticClass:"process-permissions",attrs:{model:e.formCtrData,rules:e.rules}},[n("el-table",{ref:"tableRef",staticStyle:{width:"100%"},attrs:{data:e.formCtrData.datas,height:"375","highlight-current-row":""}},[n("el-table-column",{attrs:{prop:"name",label:"控件名称",width:"160"}}),n("el-table-column",{attrs:{prop:"noSee",label:"不可见"},scopedSlots:e._u([{key:"header",fn:function(t){return[n("span",[e._v("不可见")]),n("el-checkbox",{staticStyle:{"margin-left":"10px"},on:{change:e.noSeeCheckAllChange},model:{value:e.noSeeCheckAll,callback:function(t){e.noSeeCheckAll=t},expression:"noSeeCheckAll"}})]}},{key:"default",fn:function(t){return[n("el-form-item",{attrs:{prop:"datas."+t.$index+".noSee",rules:e.rules.noSee}},[n("el-radio",{attrs:{label:"IT_FARS_004"},on:{change:function(n){return e.handleNoSeeChange(n,t.$index)}},model:{value:t.row.resourceStatus,callback:function(n){e.$set(t.row,"resourceStatus",n)},expression:"scope.row.resourceStatus"}},[e._v("不可见")])],1)]}}])}),n("el-table-column",{attrs:{prop:"onlyRead",label:"只读"},scopedSlots:e._u([{key:"header",fn:function(t){return[n("span",[e._v("只读")]),n("el-checkbox",{staticStyle:{"margin-left":"10px"},on:{change:e.onlyReadCheckAllChange},model:{value:e.onlyReadCheckAll,callback:function(t){e.onlyReadCheckAll=t},expression:"onlyReadCheckAll"}})]}},{key:"default",fn:function(t){return[n("el-form-item",{attrs:{prop:"datas."+t.$index+".onlyRead",rules:e.rules.onlyRead}},[n("el-radio",{attrs:{label:"IT_FARS_005"},on:{change:function(n){return e.handleOnlyReadChange(n,t.$index)}},model:{value:t.row.resourceStatus,callback:function(n){e.$set(t.row,"resourceStatus",n)},expression:"scope.row.resourceStatus"}},[e._v("只读")])],1)]}}])}),n("el-table-column",{attrs:{prop:"canModify",label:"可读写"},scopedSlots:e._u([{key:"header",fn:function(t){return[n("span",[e._v("可读写")]),n("el-checkbox",{staticStyle:{"margin-left":"10px"},on:{change:e.canModifyCheckAllChange},model:{value:e.canModifyCheckAll,callback:function(t){e.canModifyCheckAll=t},expression:"canModifyCheckAll"}})]}},{key:"default",fn:function(t){return[n("el-form-item",{attrs:{prop:"datas."+t.$index+".canModify",rules:e.rules.canModify}},[n("el-radio",{attrs:{label:"IT_FARS_006"},on:{change:function(n){return e.handleCanModifyChange(n,t.$index)}},model:{value:t.row.resourceStatus,callback:function(n){e.$set(t.row,"resourceStatus",n)},expression:"scope.row.resourceStatus"}},[e._v("可读写")])],1)]}}])})],1)],1)],1)},p=[],m={name:"TreeTable",props:{formCtrData:{type:Object,default:function(){return{datas:[]}}}},data:function(){return{rules:{noSee:[{require:!1}],onlyRead:[{require:!1}],canModify:[{require:!1}]},noSeeCheckAll:!1,onlyReadCheckAll:!1,canModifyCheckAll:!1}},watch:{"formCtrData.datas":{deep:!0,handler:function(e){console.log(e,"jianting");var t=e.every((function(e){return"IT_FARS_005"===e.resourceStatus})),n=e.every((function(e){return"IT_FARS_006"===e.resourceStatus})),r=e.every((function(e){return"IT_FARS_004"===e.resourceStatus}));t?(this.onlyReadCheckAll=!0,this.noSeeCheckAll=!1,this.canModifyCheckAll=!1):n?(this.canModifyCheckAll=!0,this.onlyReadCheckAll=!1,this.noSeeCheckAll=!1):r&&(this.noSeeCheckAll=!0,this.canModifyCheckAll=!1,this.onlyReadCheckAll=!1),console.log(r,t,n,"结果"),t||n||r||(this.canModifyCheckAll=!1,this.onlyReadCheckAll=!1,this.noSeeCheckAll=!1)},immediate:!0}},methods:{handleOnlyReadChange:function(e,t){console.log(this.formCtrData.datas,"table数组");var n=this.formCtrData.datas.every((function(e){return"IT_FARS_005"===e.resourceStatus}));n?(this.onlyReadCheckAll=!0,this.canModifyCheckAll=!1,this.noSeeCheckAll=!1):(this.onlyReadCheckAll=!1,this.canModifyCheckAll=!1,this.noSeeCheckAll=!1)},handleCanModifyChange:function(e,t){var n=this.formCtrData.datas.every((function(e){return"IT_FARS_006"===e.resourceStatus}));n?(this.onlyReadCheckAll=!1,this.canModifyCheckAll=!0,this.noSeeCheckAll=!1):(this.onlyReadCheckAll=!1,this.canModifyCheckAll=!1,this.noSeeCheckAll=!1)},handleNoSeeChange:function(e,t){var n=this.formCtrData.datas.every((function(e){return"IT_FARS_004"===e.resourceStatus}));n?(this.onlyReadCheckAll=!1,this.canModifyCheckAll=!1,this.noSeeCheckAll=!0):(this.noSeeCheckAll=!1,this.onlyReadCheckAll=!1,this.canModifyCheckAll=!1)},noSeeCheckAllChange:function(e){console.log(e,"哈哈哈"),this.onlyReadCheckAll=!1,this.canModifyCheckAll=!1,e?this.formCtrData.datas.forEach((function(e){e.resourceStatus="IT_FARS_004"})):this.formCtrData.datas.forEach((function(e){e.resourceStatus=""})),console.log(e,"nosee")},onlyReadCheckAllChange:function(e){this.noSeeCheckAll=!1,this.canModifyCheckAll=!1,e?this.formCtrData.datas.forEach((function(e){e.resourceStatus="IT_FARS_005"})):this.formCtrData.datas.forEach((function(e){e.resourceStatus=""}))},canModifyCheckAllChange:function(e){this.noSeeCheckAll=!1,this.onlyReadCheckAll=!1,e?this.formCtrData.datas.forEach((function(e){e.resourceStatus="IT_FARS_006"})):this.formCtrData.datas.forEach((function(e){e.resourceStatus=""}))}}},k=m,C=(n("d5b8"),Object(u["a"])(k,h,p,!1,null,null,null)),b=C.exports,y=n("d14b"),g=n("fa38"),v=n("ed08"),_={name:"RightsModule",components:{processTree:f,processTreeTable:b},data:function(){return{btnStatusList:[],processList:[],operationPermissionsList:[],operationList:[],attachmentPermissionsList:[],attachmentList:[],isOpinionList:[],opinionsValList:[],opinionsList:[],opinions:[],processNodeList:[],formList:[],flowId:"",nodeId:"",defaultProps:{children:"children",label:"label",id:"id"},formCtrData:{datas:[]},formId:"",loading:!1,checkboxFlag:!0,formLoading:!1,isFormStatusListExist:!1,isNotFormStatusListExist:!1}},computed:{},activated:function(){var e=this;this.$nextTick((function(){e.$refs.treeTable.$refs.tableRef.doLayout()}))},mounted:function(){this.getProcessList()},methods:{submitProcessConfig:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var n,r,a,o,s,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=[],r=Object(v["a"])(e.btnStatusList),a=[],o=e.btnStatusList.map((function(e){return e.resourceCode})),a=a.concat(e.operationList,e.attachmentList,e.opinionsValList,e.opinions),a.forEach((function(t){for(var n=0;n<r.length;n++)if(t===r[n].resourceCode){r[n].resourceStatus="IT_FARS_003",r[n].nodeId=e.nodeId;break}})),s=a.concat(o).filter((function(e,t,n){return n.indexOf(e)===n.lastIndexOf(e)})),s.forEach((function(t){for(var n=0;n<r.length;n++)if(t===r[n].resourceCode){r[n].resourceStatus="IT_FARS_004",r[n].nodeId=e.nodeId;break}})),e.formCtrData.datas.forEach((function(t){t.id||(t.nodeId=e.nodeId)})),n=n.concat(r,e.formCtrData.datas),t.next=12,Object(g["q"])({authConfigs:n});case 12:i=t.sent,"200"===i.code&&(e.$message.success("保存成功"),e.getProcessList());case 14:case"end":return t.stop()}}),t)})))()},getProcessList:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var n,r,a,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(y["g"])();case 2:n=t.sent,r=Array.isArray(n)&&n.map((function(e){return e.flowType})),a=Object(v["n"])(r),o=e.handleConcatArr(a,n),e.processList=o;case 7:case"end":return t.stop()}}),t)})))()},closePage:function(){var e=this,t=this.$route;this.$confirm("内容未保存,确认要关闭该页面?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.$store.dispatch("tagsView/delView",t).then((function(t){t.visitedViews;e.$router.push("/")}))}))},handleNameClick:function(e,t,n){e.hasOwnProperty("children")||(this.formReset(),this.flowId=e.value,this.getProcessNodeList(e),this.getProcessFormList(e))},formReset:function(){this.operationPermissionsList=[],this.attachmentPermissionsList=[],this.isOpinionList=[],this.opinionsList=[],this.formCtrData={datas:[]}},getProcessNodeList:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,Object(g["i"])({input:{flowName:e.label,vagueQuery:!1},pageIndex:1,pageSize:999});case 2:r=n.sent,a={nodeName:e.label,nodeId:e.value,children:r.result||[]},t.processNodeList=[a];case 5:case"end":return n.stop()}}),n)})))()},getProcessFormList:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,Object(g["d"])({flowId:e.value});case 2:r=n.sent,a={name:"页面模块",formId:"页面模块",children:r},t.formList=[a];case 5:case"end":return n.stop()}}),n)})))()},handleNodeClick:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:t.isFormStatusListExist=!1,t.formCtrData={datas:[]},t.nodeId=e.nodeId,t.loading=!0,t.checkboxFlag=!1,t.operationList=[],t.attachmentList=[],t.opinionsValList=[],t.opinions=[],t.handleNoFormConfig();case 10:case"end":return n.stop()}}),n)})))()},handleNoFormConfig:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var n,r,a,o,s,i,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n={flowId:e.flowId,type:"IT_FART_005"},t.next=3,Object(g["m"])(n);case 3:return r=t.sent,t.next=6,Object(g["f"])({flowId:e.flowId,nodeId:e.nodeId,unType:"IT_FART_005"});case 6:if(a=t.sent,e.btnStatusList=a,Array.isArray(r)&&Array.isArray(a)){t.next=10;break}return t.abrupt("return");case 10:e.operationPermissionsList=r.filter((function(e){return"IT_FART_001"===e.type})),o=a.filter((function(e){return"IT_FART_001"===e.type})),o.forEach((function(t){"IT_FARS_003"===t.resourceStatus&&e.operationList.push(t.resourceCode)})),e.attachmentPermissionsList=r.filter((function(e){return"IT_FART_002"===e.type})),s=a.filter((function(e){return"IT_FART_002"===e.type})),s.forEach((function(t){"IT_FARS_003"===t.resourceStatus&&e.attachmentList.push(t.resourceCode)})),e.isOpinionList=Array.isArray(r)&&r.filter((function(e){return"IT_FART_003"===e.type})),i=a.filter((function(e){return"IT_FART_003"===e.type})),i.forEach((function(t){"IT_FARS_003"===t.resourceStatus&&e.opinionsValList.push(t.resourceCode)})),e.opinionsList=Array.isArray(r)&&r.filter((function(e){return"IT_FART_004"===e.type})),c=a.filter((function(e){return"IT_FART_004"===e.type})),c.forEach((function(t){"IT_FARS_003"===t.resourceStatus&&e.opinions.push(t.resourceCode)})),e.loading=!1,e.checkboxFlag=!0;case 24:case"end":return t.stop()}}),t)})))()},handleFormItemClick:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.nodeId){n.next=3;break}return t.$message.warning("请选择表单列表中的流程节点"),n.abrupt("return");case 3:return t.formLoading=!0,t.formId=e.formId,n.next=7,Object(g["l"])({flowId:t.flowId,formId:e.formId,type:"IT_FART_005"});case 7:return n.sent,n.next=10,Object(g["f"])({flowId:t.flowId,nodeId:t.nodeId,formId:e.formId,type:"IT_FART_005"});case 10:r=n.sent,r.forEach((function(e){e.id||(e.resourceStatus="")})),t.formLoading=!1,t.formCtrData.datas=r;case 14:case"end":return n.stop()}}),n)})))()},handleConcatArr:function(e,t){var n=[];return e.forEach((function(e){var r={};r.label=e,r.value=e,r.children=[],t.forEach((function(t){if(t.flowType===e){var n={};n.label=t.flowName,n.value=t.flowId,r.children.push(n)}})),n.push(r)})),n}},watch:{}},A=_,S=(n("c53e"),Object(u["a"])(A,r,a,!1,null,"0fa05de6",null));t["default"]=S.exports},c53e:function(e,t,n){"use strict";n("289c")},d14b:function(e,t,n){"use strict";n.d(t,"g",(function(){return a})),n.d(t,"i",(function(){return o})),n.d(t,"j",(function(){return s})),n.d(t,"d",(function(){return i})),n.d(t,"s",(function(){return c})),n.d(t,"p",(function(){return l})),n.d(t,"e",(function(){return u})),n.d(t,"v",(function(){return d})),n.d(t,"t",(function(){return f})),n.d(t,"f",(function(){return h})),n.d(t,"u",(function(){return p})),n.d(t,"c",(function(){return m})),n.d(t,"r",(function(){return k})),n.d(t,"q",(function(){return C})),n.d(t,"k",(function(){return b})),n.d(t,"m",(function(){return y})),n.d(t,"b",(function(){return g})),n.d(t,"o",(function(){return v})),n.d(t,"n",(function(){return _})),n.d(t,"h",(function(){return A})),n.d(t,"l",(function(){return S})),n.d(t,"a",(function(){return x}));n("99af");var r=n("b775");function a(){return Object(r["a"])({url:"/task/initFlow",method:"post"})}function o(e){return Object(r["a"])({url:"/task/start",method:"post",params:e})}function s(e){return Object(r["a"])({url:"/task/readyCommit?orgId=".concat(e.orgId,"&city=").concat(e.city),method:"post",data:e.taskDTO})}function i(e){return Object(r["a"])({url:"/task/commit",method:"post",data:e})}function c(e){return Object(r["a"])({url:"/task/queryTasksPage",method:"post",data:e})}function l(e){return Object(r["a"])({url:"/task/queryTaskDetail",method:"post",data:e})}function u(e){return Object(r["a"])({url:"/task/queryRecordList",method:"post",data:e})}function d(e){return Object(r["a"])({url:"/task/breakTask",method:"post",data:e})}function f(e){return Object(r["a"])({url:"/task/readTask",method:"post",data:e})}function h(e){return Object(r["a"])({url:"/task/queryCanBackNodeList",method:"post",data:e})}function p(e){return Object(r["a"])({url:"/task/saveTask",method:"post",data:e})}function m(e){return Object(r["a"])({url:"/task/removeTask",method:"post",data:e})}function k(e){return Object(r["a"])({url:"/task/queryTaskUppriceSelectList?empName=".concat(e.empName,"&flowName=").concat(e.flowName,"&phoneNo=").concat(e.phoneNo),method:"post",data:e})}function C(e){return Object(r["a"])({url:"/task/queryTaskSelect",method:"post",params:e})}function b(e){return Object(r["a"])({url:"/task/queryEmployFlowPage",method:"post",data:e})}function y(e){return Object(r["a"])({url:"/task/queryEmployTaskRecord",method:"post",data:e})}function g(e){return Object(r["a"])({url:"/task/checkEmployUppriceGT6Month?empName=".concat(e.empName,"&flowName=").concat(e.flowName,"&phoneNo=").concat(e.phoneNo),method:"post",data:e})}function v(e){return Object(r["a"])({url:"/salary/queryNewSalaryInfo?employNum=".concat(e.employNum),method:"post",data:e})}function _(e){return Object(r["a"])({url:"/task/queryLeaveSelectList",method:"post",params:e})}function A(e){return Object(r["a"])({url:"/protectRule/getProtectRult",method:"post",params:e})}function S(e){return Object(r["a"])({url:"/employ/archives/queryEmployOfferDetail",method:"post",params:e})}function x(e){return Object(r["a"])({url:"/task/cancelTask",method:"post",data:e})}},d5b8:function(e,t,n){"use strict";n("62f4")}}]);