(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4635bf9a"],{"563e":function(e,t,a){"use strict";a("9776")},"5d12":function(e,t,a){"use strict";var r={ONLY_NUMBER_NO_ZERO:/[^1-9]/g,ONLY_NUMBER:/[\D]/g,ONLY_NUMBER_LETTER:/[\W]/g,NO_CN:/[\u0391-\uFFE5]+/,EMAIL:/\{|\}|\（|\)|\=|\%|\~|\!|\^|\&|\+|\#|\￥|\）|\{|\}|\！|[\u0391-\uFFE5]/g,NUMBER_WITH_POINT:/[^\d\.]/g};t["a"]=r},"75af":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"customer-container"},[a("div",{staticClass:"search-wrap"},[a("zm-Search",{ref:"search",attrs:{inputList:e.inputConfig,btnConfig:e.btnConfig},on:{handleAddProcess:e.handleAddProcess,search:e.search,reset:e.resetTable}})],1),a("div",{staticClass:"tableContent"},[a("zm-table",{ref:"tableRef",staticStyle:{width:"100%"},attrs:{tableData:e.tableData,columns:e.columnsList,height:"527px",currentPage:e.pageData.pageIndex,pageSize:e.pageData.pageSize,total:e.pageData.pageCount,sizeList:e.sizeList,isCheckboxGroup:!0},on:{handleCurrentChange:e.handleCurrentChange,sortChange:e.sortChange,handleSizeChange:e.handleSizeChange}})],1),a("el-dialog",{attrs:{title:e.modalTitle,visible:e.openAddModal,width:"45%","before-close":e.handleClose},on:{"update:visible":function(t){e.openAddModal=t}}},[1===e.modalContentFlag?a("el-row",[a("el-col",{staticStyle:{height:"400px",overflow:"auto"},attrs:{span:9}},[a("el-tree",{attrs:{data:e.userTreeData,props:e.defaultProps,"highlight-current":""},on:{"node-click":e.handleUserNodeClick}})],1),a("el-col",{attrs:{span:3}},[a("div",{staticStyle:{"text-align":"center"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.handleAddUser}},[e._v("添加")])],1)]),a("el-col",{attrs:{span:12}},[a("zm-table",{key:e.nameKeyFlag,staticStyle:{width:"100%"},attrs:{"header-row-style":{backgroundColor:"#f5f5f5"},tableData:e.nameTableData,columns:e.nameColumns,isShowPagenation:!1,border:""}})],1)],1):e._e(),2===e.modalContentFlag?a("el-row",[a("el-col",{attrs:{span:24}},[a("el-transfer",{key:e.roleKeyFlag,attrs:{data:e.roleDataSource,titles:["待选列表","已选列表"]},model:{value:e.roleList,callback:function(t){e.roleList=t},expression:"roleList"}})],1)],1):e._e(),3===e.modalContentFlag?a("el-row",[a("el-col",{staticStyle:{height:"400px",overflow:"auto"},attrs:{span:12}},[a("el-tree",{key:e.orgKeyFlag,ref:"orgTree",attrs:{"check-strictly":"","show-checkbox":"",data:e.orgTreeData,props:e.defaultProps,"highlight-current":"","node-key":"orgId"},on:{"check-change":e.handleOrgChecked}})],1),a("el-col",{staticStyle:{"padding-left":"10px"},attrs:{span:12}},[a("div",{staticClass:"orgTitle"},[e._v(" "+e._s("已选择部门: ("+e.checkedOrgList.length+")")+" ")]),a("div",{staticClass:"orgList",staticStyle:{height:"360px",overflow:"auto"}},e._l(e.checkedOrgList,(function(t,r){return a("div",{key:t.orgId,staticClass:"item"},[a("span",[e._v(e._s(t.orgName))]),a("i",{staticClass:"el-icon-close",on:{click:function(t){return e.handleRemoveOrg(r)}}})])})),0)])],1):e._e(),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.handleClose}},[e._v("取 消")]),a("Debounce",{attrs:{time:500,events:"click"}},[a("el-button",{directives:[{name:"has",rawName:"v-has",value:"flow.start.submit",expression:"'flow.start.submit'"}],attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitAddProcess(t)}}},[e._v("确 定")])],1)],1)],1)],1)},n=[],s=a("5530"),o=a("1da1"),i=(a("d81d"),a("4de4"),a("159b"),a("a434"),a("a15b"),a("96cf"),a("8cc7")),c=a("c91b"),l=a("a937"),u=a("5f98"),d=(a("ac1f"),a("1276"),a("ed08")),g=function(e){var t=e.$store.state.baseData.baseDataOptionList,a=t.IS_ISEF&&t.IS_ISEF.map((function(e){return{text:"是"===e.text?"有效":"无效",value:e.value}}));return[{type:"text-input",bind_key:"flowName",labelWidth:"60px",inputWidth:240,label:"流程名称",placeholder:"请输入",span:6},{type:"text-input",bind_key:"flowNo",labelWidth:"60px",inputWidth:240,label:"流程编号",span:6},{type:"select-input",bind_key:"flowType",label:"流程类型",span:6,optionList:t.IT_PTYP},{type:"select-input",bind_key:"isValid",label:"是否有效",span:6,optionList:a}]},h={span:24,leftBtnHidden:!Object(u["a"])("flow.start.list")},p=function(e){var t=Object(u["a"])("flow.start.info");return[{label:"序号",width:"50px",kind:"render",render:function(t,a){var r=a.$index+1,n=(e.pageData.pageIndex-1)*e.pageData.pageSize;return t("span",r+n)}},{label:"流程编号",prop:"flowNo",sortable:"custom"},{label:"流程名称",prop:"flowName",align:"left",sortable:"custom"},{label:"流程类型",prop:"flowType",sortable:"custom"},{label:"按姓名配置",prop:"operatingArea",kind:"render",render:function(a,r){var n=r.row.taskStartConfigList.filter((function(e){return"IT_FQRT_001"===e.startType})),s=n.length>0&&n[0].startObjectId.split(",");return a("span",{style:{color:"blue",cursor:"pointer"},on:{click:function(){return Object(o["a"])(regeneratorRuntime.mark((function a(){var s,o,i,c;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(t){a.next=3;break}return e.$message.warning("没有发起人查询权限，请联系管理员"),a.abrupt("return");case 3:if(e.userIdList=[],e.nameKeyFlag+=1,e.modalTitle="按姓名配置",e.openAddModal=!0,e.isDisalbedEvents=!1,e.modalContentFlag=1,e.flowId=r.row.flowId,e.nameTableData=[],0!==n.length){a.next=13;break}return a.abrupt("return");case 13:return console.log(r.row,"按姓名配置的列表数据"),e.configId=n[0].configId,s={},s.flowId=n[0].flowId,s.startType=n[0].startType,a.next=20,e.getLaunchDetailData(s);case 20:o=a.sent,i=o.startObjectId.split(","),console.log(i,"用户数组"),e.userIdList=i,c=[],i.forEach((function(t){var a=e.queryOrgItemByUserId(t,e.userTreeData,"userId");c.push(a)})),e.nameTableData=c,console.log(c,"最后的结果");case 28:case"end":return a.stop()}}),a)})))()}}},Array.isArray(s)?"(".concat(""==s[0]?"0":s.length,")"):"(0)")}},{label:"按角色配置",prop:"industrySubType",kind:"render",render:function(a,r){console.log(r,"scope");var n=r.row.taskStartConfigList.filter((function(e){return"IT_FQRT_002"===e.startType})),s=n.length>0&&n[0].startObjectId.split(",");return console.log(s,"角色配置"),a("span",{style:{color:"blue",cursor:"pointer"},on:{click:function(){return Object(o["a"])(regeneratorRuntime.mark((function a(){var s,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(t){a.next=3;break}return e.$message.warning("没有发起人查询权限，请联系管理员"),a.abrupt("return");case 3:if(console.log("faqiren"),e.roleKeyFlag+=1,e.roleList=[],e.modalTitle="按角色配置",e.openAddModal=!0,e.isDisalbedEvents=!1,e.modalContentFlag=2,e.flowId=r.row.flowId,0!==n.length){a.next=13;break}return a.abrupt("return");case 13:return e.configId=n[0].configId,s={},s.flowId=n[0].flowId,s.startType=n[0].startType,a.next=19,e.getLaunchDetailData(s);case 19:o=a.sent,e.roleList=o.startObjectId.split(",");case 21:case"end":return a.stop()}}),a)})))()}}},Array.isArray(s)?"(".concat(""==s[0]?"0":s.length,")"):"(0)")}},{label:"按组织配置",prop:"industrySubType",kind:"render",render:function(a,r){var n=r.row.taskStartConfigList.filter((function(e){return"IT_FQRT_003"===e.startType})),s=n.length>0&&n[0].startObjectId.split(",");return a("span",{style:{color:"blue",cursor:"pointer"},on:{click:function(){return Object(o["a"])(regeneratorRuntime.mark((function a(){var o,i,c,l;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(t){a.next=3;break}return e.$message.warning("没有发起人查询权限，请联系管理员"),a.abrupt("return");case 3:if(e.orgKeyFlag+=1,e.checkedOrgList=[],e.modalTitle="按组织配置",e.openAddModal=!0,e.isDisalbedEvents=!1,e.modalContentFlag=3,e.flowId=r.row.flowId,0!==n.length){a.next=12;break}return a.abrupt("return");case 12:return e.configId=n[0].configId,o={},o.flowId=n[0].flowId,o.startType=n[0].startType,a.next=18,e.getLaunchDetailData(o);case 18:i=a.sent,console.log(i,"组织详情数据"),c=i.startObjectId.split(","),l=[],console.log(c,"orgAARR"),c.forEach((function(t){var a=e.queryOrgItemByUserId(t,e.orgTreeData,"orgId");l.push(a)})),e.checkedOrgList=l,e.$refs.orgTree.setCheckedNodes(l),console.log(l,"最后的结果"),e.handleOrgChecked(),console.log(s,"处理之后的list");case 29:case"end":return a.stop()}}),a)})))()}}},Array.isArray(s)?"(".concat(""==s[0]?"0":s.length,")"):"(0)")}}]},f=function(e){return[{label:"部门名称",prop:"orgNm"},{label:"发起人",prop:"orgName"},{label:"操作",prop:"industrySubType",kind:"render",render:function(t,a){return t("span",{class:["renderOperation"],on:{click:function(){e.nameTableData.splice(a.$index,1),e.userIdList.splice(a.$index,1)}}},"删除")}}]},b=a("fa38"),m=a("a417"),I={name:"LaunchPeopleConfig",components:{zmTable:i["a"],zmSearch:l["a"],zmForm:c["a"]},data:function(){return{nameKeyFlag:0,roleKeyFlag:10,orgKeyFlag:100,tableData:[],pageData:{pageIndex:1,pageSize:15,pageCount:0},searchData:{},sortData:[],sizeList:[15,30,50],openAddModal:!1,industryTreeData:[],modalTitle:"默认标题",modalContentFlag:1,defaultProps:{children:"children",label:"orgName"},orgTreeData:[],userTreeData:[],checkedUserItem:{},nameTableData:[],userIdList:[],nameColumns:f(this),roleDataSource:[],roleList:[],checkedOrgList:[],flowId:"",configId:"",isDisalbedEvents:!1}},mounted:function(){this.getLaunchData(),this.getAllDataList()},activated:function(){var e=this;this.$nextTick((function(){e.$refs.tableRef.doLayoutTable()}))},computed:{inputConfig:function(){return g(this)},columnsList:function(){return p(this)},btnConfig:function(){return h}},methods:{getLaunchDetailData:function(e){return Object(o["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(b["e"])(e);case 2:return a=t.sent,t.abrupt("return",a);case 4:case"end":return t.stop()}}),t)})))()},getAllDataList:function(){this.getOrgTreeListAndUserList(),this.getRolesList()},getOrgTreeListAndUserList:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(m["z"])({});case 2:return a=t.sent,e.orgTreeData=e.deleteChildren(a),t.next=6,Object(m["K"])({input:{},pageIndex:1,pageSize:999999});case 6:r=t.sent,n=Object(d["a"])(e.orgTreeData),e.userTreeData=e.handleOrgAndUser(n,r.result);case 9:case"end":return t.stop()}}),t)})))()},getRolesList:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(m["G"])({input:{},pageIndex:1,pageSize:99999});case 2:a=t.sent,e.roleDataSource=Array.isArray(a.result)&&a.result.map((function(e){return{key:e.roleInfo?e.roleInfo.roleId:"",label:e.roleInfo?e.roleInfo.roleName:""}})),console.log(e.roleDataSource,"角色信息");case 5:case"end":return t.stop()}}),t)})))()},handleAddUser:function(){var e=this;if(this.checkedUserItem.userId){var t=this.userIdList.filter((function(t){return t===e.checkedUserItem.userId}));if(t.length>0)return void this.$message.warning("不能够重复添加");this.nameTableData.push(this.checkedUserItem),this.userIdList.push(this.checkedUserItem.userId)}},handleUserNodeClick:function(e){this.checkedUserItem=e},getParentsOrgName:function(e,t){var a=Object(d["a"])(e),r=Object(d["a"])(t);function n(e,t){t.forEach((function(t){if(e.parentId===t.orgId)return e.orgName=t.orgName+"/"+e.orgName,e;t.children&&t.children.length>0&&n(e,t.children)}))}return a.forEach((function(e){n(e,r)})),a},handleOrgChecked:function(e,t,a){var r=this.$refs.orgTree.getCheckedNodes();this.checkedOrgList=this.getParentsOrgName(r,this.orgTreeData)},handleRemoveOrg:function(e){this.checkedOrgList.splice(e,1),this.$refs.orgTree.setCheckedNodes(this.checkedOrgList)},getLaunchData:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var r,n,o,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e||{},n={input:r},o=Object.assign({},t.pageData,n),o.input.displays=t.sortData,a.next=6,Object(b["o"])(o);case 6:i=a.sent,t.pageData.pageIndex=i.pageIndex,t.pageData.pageCount=i.rowCount,t.tableData=i.result&&i.result.map((function(e){return Object(s["a"])(Object(s["a"])({},e.clientCompany),e)}));case 10:case"end":return a.stop()}}),a)})))()},handleAddProcess:function(){this.openAddModal=!0},handleClose:function(){this.openAddModal=!1},submitAddProcess:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.isDisalbedEvents){t.next=2;break}return t.abrupt("return");case 2:return a={},a.flowId=e.flowId,e.configId&&(a.configId=e.configId),1===e.modalContentFlag?(a.startType="IT_FQRT_001",a.startObjectId=e.userIdList.join(",")):2===e.modalContentFlag?(a.startType="IT_FQRT_002",console.log(e.roleList,"JoBBBBBB"),a.startObjectId=e.roleList.filter((function(e){return e})).join(",")):3===e.modalContentFlag&&(r=e.checkedOrgList.map((function(e){return e.orgId})),a.startType="IT_FQRT_003",a.startObjectId=r.join(",")),t.next=8,Object(b["j"])(a);case 8:n=t.sent,"200"===n.code?(e.isDisalbedEvents=!0,e.$message.success("发起人配置成功"),e.openAddModal=!1,e.userIdList=[],e.roleList=[],e.checkedOrgList=[],e.nameTableData=[],e.configId="",e.getLaunchData()):e.$message.warning(n.msg||"");case 10:case"end":return t.stop()}}),t)})))()},search:function(e){this.pageData.pageIndex=1;var t=JSON.parse(JSON.stringify(e));this.searchData=t,this.getLaunchData(t)},handleSizeChange:function(e){this.pageData.pageIndex=1,this.pageData.pageSize=e,this.getLaunchData(this.searchData)},resetTable:function(){this.pageData.pageIndex=1,this.searchData={},this.getLaunchData(this.searchData)},deleteFn:function(e){var t=this,a={clientCompanyId:e.clientCompanyId};this.$confirm("此操作将永久删除该数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,deleteCompany(a);case 2:e.sent,t.$message.success("删除成功"),t.getLaunchData();case 5:case"end":return e.stop()}}),e)}))))},handleCurrentChange:function(e){this.pageData.pageIndex=e,this.getLaunchData(this.searchData)},sortChange:function(e){var t=this,a="";a="ascending"===e.order?"asc":"desc";var r={display:a,field:e.prop};0===this.sortData.length?this.sortData.push(r):this.sortData.forEach((function(e,a){if(e.field===r.field){if(e.display===r.display)return void t.sortData.splice(a,1);t.sortData.splice(a,1),t.sortData.push(r)}else t.sortData.push(r)})),this.getLaunchData()},deleteChildren:function(e){for(var t=e,a=t.length;a--;a>0)t[a].children&&(t[a].children.length?this.deleteChildren(t[a].children):delete t[a].children);return e},handleOrgAndUser:function(e,t){var a=this;return e.forEach((function(e,r){t.forEach((function(t){if(e.orgId===t.orgId){!0;var a={};a.orgName="[".concat(t.userInfo.loginName,"]")+" "+t.userInfo.userName,a.userId=t.userInfo.userId,a.orgNm=e.orgName,e.children||(e.children=[]),e.children.unshift(a)}})),e.children&&a.handleOrgAndUser(e.children,t)})),e},queryOrgItemByUserId:function(e,t,a){var r="";function n(e,t){var s=t;s.forEach((function(t){if(t[a]===e)return r=t;t.children&&t.children.length>0&&n(e,t.children)}))}return n(e,t),r}},watch:{$route:function(){this.getLaunchData()}}},w=I,D=(a("563e"),a("2877")),y=Object(D["a"])(w,r,n,!1,null,"3b4e8ef7",null);t["default"]=y.exports},9776:function(e,t,a){}}]);